<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数独求解器</title>
    <style>
        /* ...其他样式保持不变... */
        body {
            font-family: 'Times New Roman', Times, serif;
            background-color: #f7f7f7;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: #333;
            color: white;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        header img {
            width: 90px;
            height: 90px;
            margin-right: 10px;
        }
        nav {
            display: flex;
        }
        nav a {
            color: white;
            text-decoration: none;
            margin-right: 20px;
        }
        /* 更新导航链接样式 */
        nav a {
            display: inline-block;
            background-color: #007bff;
            padding: 5px 15px;
            border-radius: 20px;
            transition: all 0.3s ease; /* 添加过渡效果 */
        }

        nav a:hover {
            background-color: #0056b3;
            transform: scale(1.05); /* 鼠标悬停时轻微放大 */
            text-decoration: none;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); /* 添加阴影效果 */
        }
        .container {
            display: flex;
            justify-content: space-between;
            margin: 20px;
            background-color: white;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            border-radius: 10px;
        }
        .left {
            flex: 1;
            padding: 20px;
        }
        .right {
            flex: 1;
            padding: 20px;
            border-left: 1px solid #ccc;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #image-preview {
            max-width: 100%;
            max-height: 300px;
            margin-bottom: 20px;
        }
        #file-input-label {
            display: inline-block;
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        #file-input-label:hover {
            background-color: #0056b3;
        }
        #file-input {
            display: none;
        }
        #button-container {
            display: flex;
            align-items: flex-start; /* 调整按钮的垂直对齐方式 */
        }
        #solve-button {
            display: none;
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px;
            margin-left: 10px; /* 添加左边距以与选择文件按钮对齐 */
        }
        #solve-button:hover {
            background-color: #0056b3;
        }
        #loading-spinner {
            display: none;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-top: 4px solid #007bff;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 2s linear infinite;
        }
        #info-message {
            font-size: 18px;
            color: #555;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* 为手动输入的容器添加样式 */
        .input-container {
            display: none;
            flex-direction: column;
            align-items: center;
        }

        #sudoku-grid {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 5px;
        }

        .sudoku-cell {
            width: 30px;
            height: 30px;
            text-align: center;
            font-size: 18px;
            border: 1px solid #ccc;
        }




        

        /* 更新选择文件和数独求解按钮的样式 */
        #file-input-label, #solve-button, #solve-manual-button {
            transition: all 0.3s ease; /* 添加过渡效果 */
        }

        #file-input-label:hover, #solve-button:hover, #solve-manual-button:hover {
            transform: scale(1.05); /* 鼠标悬停时轻微放大 */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); /* 添加阴影效果 */
        }

        .btn {
            background-color: #4CAF50; /* Green background */
            border: none;
            color: white; /* White text */
            padding: 10px 20px; /* Padding */
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer; /* Change cursor to hand pointer when over button */
            border-radius: 8px; /* Rounded corners */
            transition: 0.3s; /* Smooth transition for hover effect */

            width: 140px; /* Set a fixed width */
            height: 45px; /* Set a fixed height */
        }

        .btn:hover {
            background-color: #45a049; /* Slightly darker green on hover */
        }

        #botton-container2 {
            display: flex;
            justify-content: center; /* Center the buttons horizontally */
            align-items: center;     /* Center the buttons vertically */
            gap: 10px;               /* Spacing between buttons */
            height: 50px;            /* Set a fixed height for the container */
            line-height: 45px;  /*与按钮高度相同*/
            margin-bottom: 20px;
        }

        #resultImage {
            width: 400px;
            height: 300px;
            /* 如果您不希望图片被拉伸或压缩，您可以添加以下属性 */
            object-fit: contain;
        }
        .hidden {
            display: none;
        }

        .loading-message {
            font-size: 24px;          /* 增大字体大小 */
            color: #f44336;          /* 使用红色系的颜色 */
            font-family: 'Arial', sans-serif; /* 使用Arial字体，当然，这是一个示例，您可以选择其他的 */
            font-weight: bold;       /* 字体加粗 */
            text-shadow: 2px 2px 4px #aaa;  /* 添加文字阴影效果 */
            animation: blinker 1.5s linear infinite; /* 使用动画效果 */
        }

        @keyframes blinker {
        50% { opacity: 0.5; }
        }

        .dots {
            animation: dots 1.5s steps(5, end) infinite;
        }

        @keyframes dots {
            0%, 20% { color: rgba(0,0,0,0); text-shadow: none; }
            40% { color: #f44336; text-shadow: 2px 2px 4px #aaa; }
            100% { color: #f44336; text-shadow: 2px 2px 4px #aaa; }
        }

    </style>
</head>

<body>
    <!-- ...头部保持不变... -->
    <header>
        <img src="{{ sudoker_img_url }}" alt="Logo">
        <nav>
            <a href="#" id="camera-solve">拍照解</a>
            <a href="#" id="manual-input">手动输入</a>
        </nav>

    </header>
    <!-- 拍照解的容器 -->
    <div class="container" id="photo-container">
        <div class="left">
            <h2>拍照解数独</h2>
            <div id="button-container">
                <select id="sudoku-type-selector">
                    <option value="normal" selected>正常数独</option>
                    <option value="mini">迷你数独</option>
                    <option value="giant">超级数独</option>
                </select>
                <label for="file-input" id="file-input-label">选择文件</label>
                <input type="file" accept="image/*" id="file-input">
                <button id="solve-button">数独求解</button>
                <div id="loading-spinner"></div>
            </div>
            <!-- <div id="loading-spinner"></div> -->
            <div id="info-message">请选择要求解的文件</div>
            <img src="{{ holdplace_img_url }}" id="image-preview" alt="上传的图片">
        </div>
        <div class="right">
            <h2>求解结果</h2>
            <div id="result-container">
                <!-- 添加“求解中...”的HTML代码 -->
                <div id="solvingMessage" class="hidden">
                    <span class="loading-message">求解中<span class="dots">...</span></span>
                </div>
                <img src="{{ holdplace_img_url }}" id="result-image" alt="求解结果">
            </div>
        </div>
    </div>

    <!-- 手动输入的容器 -->
    <div class="container input-container" id="input-container">
        <h2>手动输入数独</h2>
        <div id="sudoku-grid">
            <!-- 使用JS动态创建9x9的矩阵 -->
        </div>
        <div id="botton-container2">
            <button id="solve-manual-button" class="btn">数独求解</button>
            <button id="resetMatrix" class="btn">重置矩阵</button>

        </div>
        
        <div id="manual-result">求解结果将在此显示</div>
    </div>

    <script>
        // ...原有的切换逻辑保持不变...
        const photoContainer = document.getElementById('photo-container');
        const inputContainer = document.getElementById('input-container');
        const cameraSolveLink = document.getElementById('camera-solve');
        const manualInputLink = document.getElementById('manual-input');

        cameraSolveLink.addEventListener('click', function (e) {
            e.preventDefault(); // 防止链接默认行为
            photoContainer.style.display = 'flex';
            inputContainer.style.display = 'none';
        });

        manualInputLink.addEventListener('click', function (e) {
            e.preventDefault(); // 防止链接默认行为
            photoContainer.style.display = 'none';
            inputContainer.style.display = 'flex';
        });
        // 动态创建9x9的输入矩阵
        const sudokuGrid = document.getElementById('sudoku-grid');
        for (let i = 0; i < 81; i++) {
            const input = document.createElement('input');
            input.type = 'text';
            input.maxLength = 1;
            input.className = 'sudoku-cell';
            sudokuGrid.appendChild(input);
        }

        // 为手动求解按钮添加事件
        const solveManualButton = document.getElementById('solve-manual-button');
        const manualResult = document.getElementById('manual-result');
        solveManualButton.addEventListener('click', function() {
            const board = [];
            for (let i = 0; i < 9; i++) {
                const row = [];
                for (let j = 0; j < 9; j++) {
                    const val = parseInt(sudokuGrid.children[i * 9 + j].value);
                    row.push(isNaN(val) ? 0 : val);
                }
                board.push(row);
            }

            fetch('http://127.0.0.1:5000/solve', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({board: board})
            })
            .then(response => response.json())
            .then(data => {
                if (data.result === 'success') {
                    const solvedBoard = data.board;
                    for (let i = 0; i < 9; i++) {
                        for (let j = 0; j < 9; j++) {
                            sudokuGrid.children[i * 9 + j].value = solvedBoard[i][j];
                        }
                    }
                } else {
                    alert("Unable to solve sudoku");
                }
            })
            .catch(error => {
                console.error(error);
            });
        });
        // ...其他原有的代码保持不变...
    </script>
    <script>
        const imageInput = document.getElementById('file-input');
        const solveButton = document.getElementById('solve-button');
        const loadingSpinner = document.getElementById('loading-spinner');
        const infoMessage = document.getElementById('info-message');
        const imagePreview = document.getElementById('image-preview');
        const resultImage = document.getElementById('result-image');
        const resultContainer = document.getElementById('result-container');
        const buttonContainer = document.getElementById('button-container');
        const solvingMessage = document.getElementById('solvingMessage');
        imageInput.addEventListener('change', function() {
            
            const selectedFile = imageInput.files[0];
            

            if (selectedFile) {
                const img = new Image();
                img.src = URL.createObjectURL(selectedFile);
                img.onload = function() {
                    const maxWidth = 400; // 设置最大宽度
                    const maxHeight = 300; // 设置最大高度
                    let width = img.width;
                    let height = img.height;
                    if (width > maxWidth || height > maxHeight) {
                        const ratio = Math.min(maxWidth / width, maxHeight / height);
                        width *= ratio;
                        height *= ratio;
                    }
                    imagePreview.style.maxWidth = width + 'px';
                    imagePreview.style.maxHeight = height + 'px';
                    imagePreview.src = img.src;
                    solveButton.style.display = 'block';
                    infoMessage.innerText = '点击求解按钮求解';
                };
            }
        });
        
        // 在显示返回的图片前，确保其大小适应容器
        resultImage.onload = function() {
            const maxWidth = 400; // 设置最大宽度
            const maxHeight = 300; // 设置最大高度
            let width = resultImage.width;
            let height = resultImage.height;
            if (width > maxWidth || height > maxHeight) {
                const ratio = Math.min(maxWidth / width, maxHeight / height);
                width *= ratio;
                height *= ratio;
            }
            resultImage.style.width = width + 'px';
            resultImage.style.height = height + 'px';
        };

        solveButton.addEventListener('click', function() {
            const selectedFile = imageInput.files[0];

            const selectedSudokuType = document.getElementById('sudoku-type-selector').value; // 获取所选的数独类型

            if (selectedFile) {
                loadingSpinner.style.display = 'inline-block';
                infoMessage.innerText = '正在求解...';

                // 显示“求解中...”的消息
                solvingMessage.classList.remove('hidden');

                // 清除图片的src，确保其隐藏
                resultImage.src = '';
                resultImage.style.display = 'none'; // 添加这行，使图片元素隐藏
                resultImage.style.width = "";
                resultImage.style.height = "";

                const formData = new FormData();
                formData.append('image', selectedFile);
                formData.append('sudokuType', selectedSudokuType);  // 添加数独类型到formData中

                fetch('http://127.0.0.1:5000/rotate_image', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    loadingSpinner.style.display = 'none';
                    
                    // 结果返回后隐藏“求解中...”的消息
                    solvingMessage.classList.add('hidden');
                    
                    if (data.rotated_image) {
                        infoMessage.innerText = '求解完毕';
                        resultImage.src = 'data:image/jpeg;base64,' + data.rotated_image;
                        resultImage.style.display = 'block'; // 显示图片
                    } else {
                        infoMessage.innerText = '未能求解，请重试';
                    }
                })
                .catch(error => {
                    loadingSpinner.style.display = 'none';
                    infoMessage.innerText = '发生错误，请重试';
                    console.error(error);
                    
                    // 若有错误，同样隐藏“求解中...”的消息
                    solvingMessage.classList.add('hidden');
                });
            } else {
                infoMessage.innerText = '请选择要求解的文件';
            }
        });



    </script>
    <script>
        const resetMatrixButton = document.getElementById("resetMatrix");
        resetMatrixButton.addEventListener('click', function() {
            for (let i = 0; i < 9; i++) {
                for (let j = 0; j < 9; j++) {
                    sudokuGrid.children[i * 9 + j].value = "";
                }
            }
        });

    </script>

</body>

</html>
